<!DOCTYPE html>
<html>

<head>
    <title>Homepage</title>
    <!-- Vue -->
    <script src="https://unpkg.com/vue@next"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <!-- ICONS -->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- chartjs-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database-compat.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="css/homestyles.css">
    <link rel="stylesheet" href="css/global.css">
    
</head>

<body>
    <div id="app1">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-success" id ='navbar'>
            <div class="container-fluid">
                <a class="navbar-brand" href="afterloginhome.html">
                    <i class="fas fa-heartbeat customSize"></i>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="afterloginhome.html">Home</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="trackerDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Tracker
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="trackerDropdown">
                                <li><a class="dropdown-item" href="bloodpressure.html">Blood Pressure Tracker</a>
                                </li>
                                <li><a class="dropdown-item" href="bloodglucose.html">Blood Glucose Tracker</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="alert.html">Notification</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="map.html">Map</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="forum.html">Forum</a>
                        </li>
                    </ul>

                    <ul class="navbar-nav d-flex flex-row ms-auto me-3">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                <li><a class="dropdown-item" @click="logout()">Logout</a></li>
                            </ul>

                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Navbar -->
    </div>
    <!-- <div class="container-fluid"> -->
        <header>
            <div class="banner">
                <div class="banner-container">
                    <h1 class="banner-title aos-init aos-animate" data-aos="fade-in" data-aos-duration="1500">
                        Welcome to <span>HealthBuddy</span>!
                    </h1>
                    <h6 class="aos-init aos-animate" data-aos="fade-in" data-aos-duration="1500">Your one-stop solution to
                        keeping your health in check</h6>
                </div>
            </div>
        </header>
    <!-- </div> -->
    <!-- JUMBOTRON -->
    <div class="p-4 mb-4 bg-success rounded-3">
        <div class="container-fluid py-3">
            <div id = 'app4'>
                <h1 class="display-5 fw-bold" style = "color: white;">{{currentUser.fName + " " +currentUser.lName}}'s Charts</h1>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <!-- Table 1 -->
                    <div class="col-lg col-md-12 p-5 rounded-3 border border-3 border-success-subtle" id="app2"
                        style="background-color: white;">
                        <h1 class="display-7 fw-bold">Blood Glucose</h1>
                        <!-- Inputbox -->
                        <div class="row">
                            <div class="col-6">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="floatingInputGroup1" v-model="year">
                                    <label for="floatingInputGroup1">Year(YYYY)</label>
                                </div>
                            </div>
                            <!-- select -->
                            <div class="col-6">
                                <div class="form-floating">
                                    <select class="form-select" id="floatingSelectDisabled" v-model="month">
                                        <option selected value="0">Jan</option>
                                        <option value="1">Feb</option>
                                        <option value="2">Mar</option>
                                        <option value="3">Apr</option>
                                        <option value="4">May</option>
                                        <option value="5">Jun</option>
                                        <option value="6">Jul</option>
                                        <option value="7">Aug</option>
                                        <option value="8">Sep</option>
                                        <option value="9">Oct</option>
                                        <option value="10">Nov</option>
                                        <option value="11">Dec</option>
                                    </select>
                                    <label for="floatingSelectDisabled">Select Month</label>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="text-end">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-primary" @click="filter()">Filter</button>
                                    <button type="button" class="btn btn-primary" @click="reset()">Reset</button>
                                </div>
                            </div>
                        </div>
                        <canvas id="lineChart"></canvas>
                    </div>
                    <div class="col-lg-1 col-md-12">&nbsp;</div>
                    <!-- Table 2-->
                    <div class="col-lg col-md-12 p-5 rounded-3 border border-3 border-success-subtle" id="app3"
                        style="background-color: white;" id="app3" style="background-color: white;">
                        <h1 class="display-7 fw-bold">Blood Pressure</h1>
                        <!-- Inputbox -->
                        <div class="row">
                            <div class="col-6">
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="text2" v-model="year">
                                    <label for="text2">Year(YYYY)</label>
                                </div>
                            </div>
                            <!-- select -->
                            <div class="col-6">
                                <div class="form-floating">
                                    <select class="form-select" id="select1" v-model="month">
                                        <option selected value="0">Jan</option>
                                        <option value="1">Feb</option>
                                        <option value="2">Mar</option>
                                        <option value="3">Apr</option>
                                        <option value="4">May</option>
                                        <option value="5">Jun</option>
                                        <option value="6">Jul</option>
                                        <option value="7">Aug</option>
                                        <option value="8">Sep</option>
                                        <option value="9">Oct</option>
                                        <option value="10">Nov</option>
                                        <option value="11">Dec</option>
                                    </select>
                                    <label for="select1">Select Month</label>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="text-end">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-primary" @click="filter()">Filter</button>
                                    <button type="button" class="btn btn-primary" @click="reset()">Reset</button>
                                </div>
                            </div>
                        </div>
                        <canvas id="lineChart1"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

       <!-- Slider -->
    <div class="slider-container container-fluid  aos-init aos-animate" data-aos="fade" data-aos-duration="1500"">
        <h1 class=" banner-title" style="padding-top: 5px">Useful Links</h1>

        <input type="radio" name="slider" id="s1" checked>
        <input type="radio" name="slider" id="s2">
        <input type="radio" name="slider" id="s3">
        <input type="radio" name="slider" id="s4">
        <input type="radio" name="slider" id="s5">

        <div class="cards">
            <label for="s1" id="slide1">
                <div class="card">
                    <div class="image">
                        <img src="assets/img/bloodglucoselevels.webp" alt="Blood Glucose Chart">
                        <div class="dots">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>

                    <div class="infos">
                        <span class="name">Blood Glucose Chart</span>
                        <span class="points">Blood glucose levels can vary throughout the day, so it's important to
                            understand when and how to measure it.</span>

                        <a href="https://medlineplus.gov/bloodglucose.html#:~:text=Blood%20glucose%2C%20or%20blood%20sugar,your%20pancreas%20to%20release%20insulin."
                            target="_blank" class="btn-details">Click me!</a>

                        <div class="actions">
                            <i class="fa-regular fa-heart"></i>
                            <i class="fa-regular fa-bookmark"></i>
                            <i class="fa-solid fa-share-nodes"></i>
                        </div>

                    </div>
                </div>
            </label>

            <label for="s2" id="slide2">

                <div class="card">

                    <div class="image">
                        <img src="assets/img/bloodglucosemonitoring.png" alt="Blood Glucose Monitoring">
                        <div class="dots">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>

                    <div class="infos">
                        <span class="name">Blood Glucose Monitoring</span>
                        <span class="points">Monitoring blood glucose levels is crucial and helps in managing the
                            condition and avoiding complications.</span>

                        <a href="https://www.youtube.com/watch?v=MZCf621bRHs&pp=ygUdaG93IHRvIG1lYXN1cmUgYmxvb2QgZ2x1Y29zZSA%3D"
                            target="_blank" class="btn-details">Click me!</a>

                        <div class="actions">
                            <i class="fa-regular fa-heart"></i>
                            <i class="fa-regular fa-bookmark"></i>
                            <i class="fa-solid fa-share-nodes"></i>
                        </div>

                    </div>
                </div>
            </label>

            <label for="s3" id="slide3">

                <div class="card">

                    <div class="image">
                        <img src="assets/img/Blood+Pressure+Chart+1200x630.webp" alt="Blood Pressure Chart">
                        <div class="dots">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>

                    <div class="infos">
                        <span class="name">Blood Pressure Chart</span>
                        <span class="points">Normal blood pressure is typcially considered to be around 120/80 mm
                            Hg.</span>

                        <a href="https://www.ncbi.nlm.nih.gov/books/NBK279251/#:~:text=A%20person%20is%20considered%20to,like%20dizziness%20or%20trouble%20seeing."
                            target="_blank" class="btn-details">Click me!</a>

                        <div class="actions">
                            <i class="fa-regular fa-heart"></i>
                            <i class="fa-regular fa-bookmark"></i>
                            <i class="fa-solid fa-share-nodes"></i>
                        </div>

                    </div>
                </div>
            </label>

            <label for="s4" id="slide4">

                <div class="card">

                    <div class="image">
                        <img src="assets/img/bloodpressuremonitoring.png" alt="Blood Pressure Monitoring">
                        <div class="dots">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>

                    <div class="infos">
                        <span class="name">Blood Pressure Monitoring</span>
                        <span class="points">Regular blood pressure monitoring is essential and possible with home blood
                            pressure monitors.</span>

                        <a href="https://www.youtube.com/watch?v=UGOoeqSo_ws&pp=ygUdaG93IHRvIG1lYXN1cmUgYmxvb2QgcHJlc3N1cmU%3D" target="_blank"
                            class="btn-details">Click me!</a>

                        <div class="actions">
                            <i class="fa-regular fa-heart"></i>
                            <i class="fa-regular fa-bookmark"></i>
                            <i class="fa-solid fa-share-nodes"></i>
                        </div>

                    </div>
                </div>
            </label>

            <label for="s5" id="slide5">

                <div class="card">

                    <div class="image">
                        <img src="assets/img/dietandexercise.webp" alt="Diet and Exercise">
                        <div class="dots">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </div>

                    <div class="infos">
                        <span class="name">Diet and Exercise</span>
                        <span class="points">Diet and physical activity have a significant impact on blood glucose and
                            blood pressure levels.</span>

                        <a href="https://health.mo.gov/living/wellness/nutrition/nutritionphysicalactivity/#:~:text=Eating%20smart%20and%20being%20active,and%2For%20promote%20weight%20loss"
                            target="_blank" class="btn-details">Click me!</a>

                        <div class="actions">
                            <i class="fa-regular fa-heart"></i>
                            <i class="fa-regular fa-bookmark"></i>
                            <i class="fa-solid fa-share-nodes"></i>
                        </div>

                    </div>
                </div>
            </label>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer-basic aos-init aos-animate" data-aos="fade-in" data-aos-duration="1500" >
        <footer>
            <div id = "app5" class = "social text-dark fw-bold">
                Logged in as: {{currentUser.fName + " " +currentUser.lName}} 
            </div>
            <div class="social">
                <a href="#">
                    <iconify-icon icon="ion:logo-apple-appstore"></iconify-icon>
                </a>
                <a href="#">
                    <iconify-icon icon="ion:logo-google-playstore"></iconify-icon>
                </a>
                <a href="#">
                    <iconify-icon icon="ion:logo-instagram"></iconify-icon>
                </a>
            </div>
            <p class="copyright">HealthBuddy &copy; IS216</p>
        </footer>
    
    </div>

    <!-- AOS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>AOS.init();</script>
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
    <!-- Datatables -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js"
        crossorigin="anonymous"></script>

</body>

</html>

<script>
    const firebaseConfig = {
        databaseURL: "https://wad2-project-577ea-default-rtdb.asia-southeast1.firebasedatabase.app",
        apiKey: "AIzaSyDWR7cQApDtFlD2wx5Btku67Bhg8_xwsUg",
        authDomain: "wad2-project-577ea.firebaseapp.com",
        projectId: "wad2-project-577ea",
        storageBucket: "wad2-project-577ea.appspot.com",
        messagingSenderId: "878918082978",
        appId: "1:878918082978:web:250e7cfd55234ea00012fb",
        measurementId: "G-SLGD98DFQ5"
    };
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();

    const app = Vue.createApp({
        data() {
            return {
                currentUser: null,
            }
        },
        methods: {
            logout() {
                localStorage.removeItem("user");
                window.location.href = "login.html";
            }
        },
        created() {
            this.currentUser = JSON.parse(localStorage.getItem("user"));
            console.log(this.currentUser);
        },
    }).mount("#app1");

    const app9 = Vue.createApp({
        data() {
            return {
                currentUser: null,
            }
        },
        created() {
            this.currentUser = JSON.parse(localStorage.getItem("user"));
        },
    }).mount("#app4");

    const app10 = Vue.createApp({
        data() {
            return {
                currentUser: null,
            }
        },
        created() {
            this.currentUser = JSON.parse(localStorage.getItem("user"));
        },
    }).mount("#app5");
    
    const app1 = Vue.createApp({
        data() {
            return {
                currentUser: null,
                month: "",
                year: "",
            }
        },
        methods: {
            async reset() {
                var ref = database.ref("users/" + this.currentUser.userKey + "/bgEntries");
                let snapshot = await ref.once('value')
                this.entries = snapshot.val();

                //Convert entries to array in order to use DataTable
                let entriesArr = Object.values(this.entries);
                let dates = [];
                let bgRecords = [];
                console.log(entriesArr);
                for (entry in entriesArr) {
                    // console.log(entriesArr[entry]);
                    var rec = entriesArr[entry]
                    dates.push(rec.date)
                    bgRecords.push(rec.bgLevel)
                }
                // console.log(bgRecords);
                var chartData = {
                    labels: dates, // X-axis labels
                    datasets: [
                        {
                            label: "Blood Glucose (mg/dl)",
                            data: bgRecords, // Your data points
                            borderColor: "rgb(75, 192, 192)",
                            fill: false,
                        },
                    ],
                };
                document.getElementById("lineChart").remove()
                let parentEle = document.getElementById('app2');
                let ele = document.createElement("canvas");
                ele.setAttribute("id", "lineChart");
                parentEle.appendChild(ele);
                var ctx = document.getElementById("lineChart").getContext("2d");
                var lineChart = new Chart(ctx, {
                    type: "line",
                    data: chartData,
                });
            },
            async filter() {
                var ref = database.ref("users/" + this.currentUser.userKey + "/bgEntries");
                let snapshot = await ref.once('value')
                this.entries = snapshot.val();

                //Convert entries to array in order to use DataTable
                let entriesArr = Object.values(this.entries);
                let dates = [];
                let bgRecords = [];
                console.log(entriesArr);
                for (entry in entriesArr) {
                    // console.log(entriesArr[entry]);
                    var rec = entriesArr[entry];
                    let month = new Date(rec.date).getMonth();
                    let year = new Date(rec.date).getFullYear();
                    // console.log(month, year);
                    if (year == this.year && month == this.month) {
                        dates.push(rec.date)
                        bgRecords.push(rec.bgLevel)
                    }
                }
                var chartData = {
                    labels: dates, // X-axis labels
                    datasets: [
                        {
                            label: "Blood glucose (mg/dl)",
                            data: bgRecords, // Your data points
                            borderColor: "rgb(75, 192, 192)",
                            fill: false,
                        },
                    ],
                };

                document.getElementById("lineChart").remove()
                let parentEle = document.getElementById('app2');
                let ele = document.createElement("canvas");
                ele.setAttribute("id", "lineChart");
                parentEle.appendChild(ele);
                var ctx = document.getElementById("lineChart").getContext("2d");
                var lineChart = new Chart(ctx, {
                    type: "line",
                    data: chartData,
                });


            },
            async getEntries() {
                var ref = database.ref("users/" + this.currentUser.userKey + "/bgEntries");
                let snapshot = await ref.once('value')
                this.entries = snapshot.val();

                //Convert entries to array in order to use DataTable
                let entriesArr = Object.values(this.entries);
                let dates = [];
                let bgRecords = [];
                console.log(entriesArr);
                for (entry in entriesArr) {
                    // console.log(entriesArr[entry]);
                    var rec = entriesArr[entry]
                    dates.push(rec.date)
                    bgRecords.push(rec.bgLevel)
                }
                // console.log(bgRecords);
                var chartData = {
                    labels: dates, // X-axis labels
                    datasets: [
                        {
                            label: "Blood Glucose (mg/dl)",
                            data: bgRecords, // Your data points
                            borderColor: "rgb(75, 192, 192)",
                            fill: false,
                        },
                    ],
                };
                var ctx = document.getElementById("lineChart").getContext("2d");
                var lineChart = new Chart(ctx, {
                    type: "line",
                    data: chartData,
                });

            }
        },
        created() {
            this.currentUser = JSON.parse(localStorage.getItem("user"));
            this.getEntries();
        },
    }).mount("#app2")

    const app2 = Vue.createApp({
        data() {
            return {
                currentUser: null,
                month: "",
                year: "",
            }
        },
        methods: {
            async reset() {
                var ref = database.ref("users/" + this.currentUser.userKey + "/entries");
                let snapshot = await ref.once('value')
                this.entries = snapshot.val();

                //Convert entries to array in order to use DataTable
                let entriesArr = Object.values(this.entries);
                let dates = [];
                let diaRecord = [];
                let sysRecord = [];
                console.log(entriesArr);
                for (entry in entriesArr) {
                    var rec = entriesArr[entry];
                    dates.push(rec.date)
                    diaRecord.push(rec.diastolicBP)
                    sysRecord.push(rec.systolicBP)
                }
                // console.log(bgRecords);
                var chartData = {
                    labels: dates, // X-axis labels
                    datasets: [
                        {
                            label: "Diastolic BP",
                            data: diaRecord,
                            borderColor: "rgb(255, 42, 87)",
                            fill: false,
                        },
                        {
                            label: "Systolic BP",
                            data: sysRecord, // Your data points
                            borderColor: "rgb(0, 113, 255)",
                            fill: false,
                        },
                    ],
                };
                document.getElementById("lineChart1").remove()
                let parentEle = document.getElementById('app3');
                let ele = document.createElement("canvas");
                ele.setAttribute("id", "lineChart1");
                parentEle.appendChild(ele);
                var ctx = document.getElementById("lineChart1").getContext("2d");
                var lineChart = new Chart(ctx, {
                    type: "line",
                    data: chartData,
                });
            },
            async filter() {
                var ref = database.ref("users/" + this.currentUser.userKey + "/entries");
                let snapshot = await ref.once('value')
                this.entries = snapshot.val();

                //Convert entries to array in order to use DataTable
                let entriesArr = Object.values(this.entries);
                let dates = [];
                let diaRecord = [];
                let sysRecord = [];
                for (entry in entriesArr) {
                    var rec = entriesArr[entry];
                    let month = new Date(rec.date).getMonth();
                    let year = new Date(rec.date).getFullYear();
                    if (year == this.year && month == this.month) {
                        dates.push(rec.date)
                        diaRecord.push(rec.diastolicBP)
                        sysRecord.push(rec.systolicBP)
                    }
                }
                var chartData = {
                    labels: dates, // X-axis labels
                    datasets: [
                        {
                            label: "Diastolic BP",
                            data: diaRecord,
                            borderColor: "rgb(255, 42, 87)",
                            fill: false,
                        },
                        {
                            label: "Systolic BP",
                            data: sysRecord, // Your data points
                            borderColor: "rgb(0, 113, 255)",
                            fill: false,
                        },
                    ],
                };

                document.getElementById("lineChart1").remove()
                let parentEle = document.getElementById('app3');
                let ele = document.createElement("canvas");
                ele.setAttribute("id", "lineChart1");
                parentEle.appendChild(ele);
                var ctx = document.getElementById("lineChart1").getContext("2d");
                var lineChart = new Chart(ctx, {
                    type: "line",
                    data: chartData,
                });


            },
            async getEntries() {
                var ref = database.ref("users/" + this.currentUser.userKey + "/entries");
                let snapshot = await ref.once('value')
                this.entries = snapshot.val();

                //Convert entries to array in order to use DataTable
                let entriesArr = Object.values(this.entries);
                let dates = [];
                let diaRecord = [];
                let sysRecord = [];
                console.log(entriesArr);
                for (entry in entriesArr) {
                    // console.log(entriesArr[entry]);
                    var rec = entriesArr[entry]
                    dates.push(rec.date)
                    diaRecord.push(rec.diastolicBP)
                    sysRecord.push(rec.systolicBP)
                }
                // console.log(bgRecords);
                var chartData = {
                    labels: dates, // X-axis labels
                    datasets: [
                        {
                            label: "Diastolic BP",
                            data: diaRecord,
                            borderColor: "rgb(255, 42, 87)",
                            fill: false,
                        },
                        {
                            label: "Systolic BP",
                            data: sysRecord, // Your data points
                            borderColor: "rgb(0, 113, 255)",
                            fill: false,
                        },
                    ],
                };
                var ctx = document.getElementById("lineChart1").getContext("2d");
                var lineChart = new Chart(ctx, {
                    type: "line",
                    data: chartData,
                });

            }
        },
        created() {
            this.currentUser = JSON.parse(localStorage.getItem("user"));
            this.getEntries();
        },
    }).mount("#app3")


</script>